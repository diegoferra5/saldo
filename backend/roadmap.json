{
  "project": {
    "name": "Saldo Backend MVP",
    "description": "API de gesti√≥n financiera personal para M√©xico",
    "tech_stack": ["FastAPI", "SQLAlchemy", "Pydantic", "Supabase/Postgres", "Python 3.11"],
    "current_branch": "feature/transactions-account-endpoints",
    "version": "1.0.0-MVP",
    "last_updated": "2025-12-29"
  },
  "status": {
    "completed": [
      "Infrastructure & Database Setup",
      "SQLAlchemy Models (User, Account, Statement, Transaction)",
      "Auth Router (/api/auth)",
      "Statements Router (/api/statements) - Full CRUD + Processing",
      "PDF Parser (BBVA Debit)",
      "Transaction Service (with deduplication)",
      "SSL Configuration for Supabase"
    ],
    "in_progress": "Phase 1 - CRUD Endpoints",
    "next_up": "Transactions Router Implementation"
  },
  "phases": [
    {
      "id": "phase-1",
      "name": "CRUD Endpoints - API B√°sica",
      "status": "in_progress",
      "priority": "critical",
      "estimated_hours": 14,
      "description": "Completar endpoints REST para Transactions y Accounts con validaciones robustas",
      "milestones": [
        {
          "id": "milestone-1.1",
          "name": "Transactions Router",
          "status": "pending",
          "priority": "critical",
          "estimated_hours": 4,
          "complexity": "medium",
          "description": "Implementar endpoints completos para consulta y edici√≥n de transacciones",
          "dependencies": [
            "transaction_service.py (already implemented)",
            "schemas/transactions.py (already implemented)",
            "JWT auth middleware (already implemented)"
          ],
          "endpoints": [
            {
              "method": "GET",
              "path": "/api/transactions/",
              "description": "Lista paginada de transacciones con filtros",
              "auth_required": true,
              "query_params": {
                "account_id": {
                  "type": "UUID",
                  "required": false,
                  "description": "Filtrar por cuenta espec√≠fica"
                },
                "start_date": {
                  "type": "date",
                  "required": false,
                  "description": "Fecha inicio (YYYY-MM-DD)",
                  "validation": "Must be <= end_date if both provided"
                },
                "end_date": {
                  "type": "date",
                  "required": false,
                  "description": "Fecha fin (YYYY-MM-DD)",
                  "validation": "Must be >= start_date if both provided"
                },
                "movement_type": {
                  "type": "enum",
                  "required": false,
                  "values": ["CARGO", "ABONO", "UNKNOWN"],
                  "description": "Tipo de movimiento"
                },
                "needs_review": {
                  "type": "boolean",
                  "required": false,
                  "description": "Filtrar transacciones que requieren revisi√≥n"
                },
                "limit": {
                  "type": "integer",
                  "required": false,
                  "default": 50,
                  "max": 200,
                  "validation": "Must be between 1 and 200"
                },
                "offset": {
                  "type": "integer",
                  "required": false,
                  "default": 0,
                  "validation": "Must be >= 0"
                }
              },
              "response": {
                "type": "List[TransactionList]",
                "order_by": "transaction_date DESC"
              },
              "service_method": "get_transactions_by_user()",
              "edge_cases": [
                "limit > 200 should cap to max 200",
                "offset < 0 should return 422",
                "start_date > end_date should return 422",
                "invalid movement_type should return 422"
              ]
            },
            {
              "method": "GET",
              "path": "/api/transactions/stats",
              "description": "Estad√≠sticas de transacciones por tipo",
              "auth_required": true,
              "query_params": {},
              "response": {
                "type": "object",
                "schema": {
                  "CARGO": "integer (count)",
                  "ABONO": "integer (count)",
                  "UNKNOWN": "integer (count)"
                }
              },
              "service_method": "count_transactions_by_type()",
              "notes": [
                "MVP: Stats globales del usuario (sin filtros)",
                "V1.1: Considerar agregar filtros opcionales (account_id, date_range)"
              ]
            },
            {
              "method": "GET",
              "path": "/api/transactions/{id}",
              "description": "Obtener detalle de transacci√≥n espec√≠fica",
              "auth_required": true,
              "path_params": {
                "id": {
                  "type": "UUID",
                  "description": "ID de la transacci√≥n"
                }
              },
              "response": {
                "type": "TransactionResponse"
              },
              "security": {
                "ownership_check": "Filter by user_id from JWT token",
                "error_handling": "Return 404 (not 403) if not found or not owned by user to avoid leaking existence"
              },
              "edge_cases": [
                "ID not found => 404",
                "ID belongs to another user => 404 (not 403)",
                "Invalid UUID format => 422"
              ]
            },
            {
              "method": "PATCH",
              "path": "/api/transactions/{id}",
              "description": "Actualizar clasificaci√≥n de transacci√≥n",
              "auth_required": true,
              "path_params": {
                "id": {
                  "type": "UUID",
                  "description": "ID de la transacci√≥n"
                }
              },
              "body": {
                "type": "TransactionUpdate",
                "fields": {
                  "movement_type": {
                    "type": "MovementType enum",
                    "required": false,
                    "description": "Tipo de movimiento (CARGO/ABONO/UNKNOWN)"
                  },
                  "needs_review": {
                    "type": "boolean",
                    "required": false,
                    "description": "Marcar para revisi√≥n"
                  },
                  "category": {
                    "type": "string",
                    "required": false,
                    "description": "Categor√≠a (para V1.1)"
                  }
                }
              },
              "response": {
                "type": "TransactionResponse"
              },
              "business_rules": [
                "If movement_type != UNKNOWN => auto set needs_review = False",
                "If movement_type == UNKNOWN => auto set needs_review = True",
                "Only update fields that are present in request (partial update)"
              ],
              "security": {
                "ownership_check": "Verify transaction belongs to current user",
                "error_handling": "404 if not found or not owned"
              },
              "service_method": "update_transaction_classification()",
              "edge_cases": [
                "Invalid movement_type value => 422",
                "Transaction belongs to another user => 404",
                "Empty body => should be accepted (no-op)"
              ]
            }
          ],
          "files_to_create": [
            {
              "path": "backend/app/routes/transactions.py",
              "description": "New router with 4 endpoints",
              "dependencies": [
                "from app.services.transaction_service import get_transactions_by_user, count_transactions_by_type, update_transaction_classification",
                "from app.schemas.transactions import TransactionResponse, TransactionList, TransactionUpdate",
                "from app.core.security import get_current_user"
              ]
            }
          ],
          "files_to_modify": [
            {
              "path": "backend/app/main.py",
              "changes": [
                "Import transactions router",
                "Add app.include_router(transactions.router, prefix='/api/transactions', tags=['Transactions'])"
              ]
            }
          ],
          "testing_checklist": {
            "happy_path": [
              "GET /api/transactions/ without filters returns all user's transactions",
              "GET /api/transactions/ with limit=10 returns max 10 results",
              "GET /api/transactions/ with movement_type=CARGO filters correctly",
              "GET /api/transactions/stats returns correct counts",
              "GET /api/transactions/{id} with valid ID returns transaction",
              "PATCH /api/transactions/{id} updates movement_type correctly",
              "PATCH /api/transactions/{id} with movement_type=CARGO auto-sets needs_review=False"
            ],
            "edge_cases": [
              "GET /api/transactions/ with limit=5000 caps to 200",
              "GET /api/transactions/ with start_date > end_date returns 422",
              "GET /api/transactions/{id} of another user returns 404",
              "PATCH /api/transactions/{id} with invalid movement_type returns 422"
            ],
            "security": [
              "All endpoints require valid JWT token",
              "GET/PATCH by ID verify ownership (user_id match)",
              "Returns 404 (not 403) for unauthorized access"
            ]
          },
          "acceptance_criteria": [
            "All 4 endpoints implemented and documented in Swagger",
            "Filters working (account_id, dates, type, needs_review)",
            "Pagination works correctly (limit/offset validation)",
            "Stats returns accurate counts",
            "PATCH updates only sent fields (partial update)",
            "Auth validates ownership on all ID-based endpoints",
            "Business rules applied automatically (needs_review logic)",
            "All edge cases tested manually in Swagger"
          ]
        },
        {
          "id": "milestone-1.2",
          "name": "Accounts Router",
          "status": "pending",
          "priority": "high",
          "estimated_hours": 4,
          "complexity": "medium",
          "description": "CRUD completo de cuentas bancarias con soft delete",
          "dependencies": [
            "account_service.py (already implemented)",
            "Need to create: schemas/account.py"
          ],
          "endpoints": [
            {
              "method": "GET",
              "path": "/api/accounts/",
              "description": "Lista de cuentas del usuario con filtros opcionales",
              "auth_required": true,
              "query_params": {
                "bank_name": {
                  "type": "string",
                  "required": false,
                  "description": "Filtrar por banco (ej: BBVA, Santander)"
                },
                "account_type": {
                  "type": "enum",
                  "required": false,
                  "values": ["DEBIT", "CREDIT"],
                  "description": "Tipo de cuenta"
                },
                "is_active": {
                  "type": "boolean",
                  "required": false,
                  "default": true,
                  "description": "Mostrar solo cuentas activas"
                }
              },
              "response": {
                "type": "List[AccountResponse]",
                "order_by": "created_at DESC"
              },
              "service_method": "list_user_accounts()"
            },
            {
              "method": "POST",
              "path": "/api/accounts/",
              "description": "Crear cuenta bancaria (o retornar existente)",
              "auth_required": true,
              "body": {
                "type": "AccountCreate",
                "fields": {
                  "bank_name": {
                    "type": "string",
                    "required": true,
                    "validation": "Normalized to uppercase",
                    "example": "BBVA"
                  },
                  "account_type": {
                    "type": "AccountType enum",
                    "required": true,
                    "values": ["DEBIT", "CREDIT"]
                  },
                  "display_name": {
                    "type": "string",
                    "required": false,
                    "max_length": 100,
                    "example": "BBVA Azul - Principal"
                  }
                }
              },
              "response": {
                "type": "AccountResponse"
              },
              "business_rules": [
                "Uniqueness key: (user_id, bank_name, account_type)",
                "display_name does NOT affect uniqueness (can have 2 BBVA accounts with different names)",
                "bank_name normalized to uppercase before saving",
                "If account exists with same (user_id, bank_name, account_type) => return existing (get_or_create pattern)"
              ],
              "service_method": "get_or_create_account()",
              "edge_cases": [
                "Duplicate (bank_name + account_type) => return existing account",
                "Missing required fields => 422",
                "Invalid account_type => 422"
              ]
            },
            {
              "method": "GET",
              "path": "/api/accounts/{id}",
              "description": "Obtener detalle de cuenta espec√≠fica",
              "auth_required": true,
              "path_params": {
                "id": {
                  "type": "UUID",
                  "description": "ID de la cuenta"
                }
              },
              "response": {
                "type": "AccountResponse"
              },
              "security": {
                "ownership_check": "Filter by user_id from JWT token",
                "error_handling": "404 if not found or not owned"
              },
              "service_method": "get_account_by_id()"
            },
            {
              "method": "PATCH",
              "path": "/api/accounts/{id}",
              "description": "Actualizar cuenta (display_name, is_active)",
              "auth_required": true,
              "path_params": {
                "id": {
                  "type": "UUID",
                  "description": "ID de la cuenta"
                }
              },
              "body": {
                "type": "AccountUpdate",
                "fields": {
                  "display_name": {
                    "type": "string",
                    "required": false,
                    "max_length": 100
                  },
                  "is_active": {
                    "type": "boolean",
                    "required": false
                  }
                }
              },
              "response": {
                "type": "AccountResponse"
              },
              "business_rules": [
                "Only update fields present in request body",
                "Cannot change bank_name or account_type (immutable)",
                "Deactivating account (is_active=False) does NOT delete statements/transactions"
              ],
              "security": {
                "ownership_check": "Verify account belongs to current user"
              },
              "service_method": "update_account()"
            },
            {
              "method": "DELETE",
              "path": "/api/accounts/{id}",
              "description": "Soft delete de cuenta (is_active=False)",
              "auth_required": true,
              "path_params": {
                "id": {
                  "type": "UUID",
                  "description": "ID de la cuenta"
                }
              },
              "response": {
                "status_code": 204,
                "description": "No Content"
              },
              "business_rules": [
                "Soft delete: Sets is_active=False (no hard delete)",
                "Idempotent: If already inactive, still returns 204 OK",
                "Statements and transactions remain visible (only account hidden in UI)",
                "Can be reactivated with PATCH is_active=True"
              ],
              "security": {
                "ownership_check": "Verify account belongs to current user"
              },
              "service_method": "deactivate_account()",
              "edge_cases": [
                "DELETE already inactive account => 204 OK (idempotent)",
                "DELETE account with transactions => 204 OK (soft delete, data preserved)"
              ]
            }
          ],
          "files_to_create": [
            {
              "path": "backend/app/schemas/account.py",
              "description": "Pydantic schemas for Account endpoints",
              "schemas": [
                {
                  "name": "AccountResponse",
                  "fields": {
                    "id": "UUID",
                    "user_id": "UUID",
                    "bank_name": "str",
                    "account_type": "AccountType enum",
                    "display_name": "Optional[str]",
                    "is_active": "bool",
                    "created_at": "datetime",
                    "updated_at": "datetime"
                  }
                },
                {
                  "name": "AccountCreate",
                  "fields": {
                    "bank_name": "str (required)",
                    "account_type": "AccountType enum (required)",
                    "display_name": "Optional[str]"
                  }
                },
                {
                  "name": "AccountUpdate",
                  "fields": {
                    "display_name": "Optional[str]",
                    "is_active": "Optional[bool]"
                  }
                }
              ]
            },
            {
              "path": "backend/app/routes/accounts.py",
              "description": "New router with 5 endpoints"
            }
          ],
          "files_to_modify": [
            {
              "path": "backend/app/main.py",
              "changes": [
                "Import accounts router",
                "Add app.include_router(accounts.router, prefix='/api/accounts', tags=['Accounts'])"
              ]
            }
          ],
          "testing_checklist": {
            "happy_path": [
              "POST /api/accounts/ creates new account",
              "POST /api/accounts/ with duplicate (bank+type) returns existing",
              "GET /api/accounts/ returns all user's accounts",
              "GET /api/accounts/ with is_active=true filters correctly",
              "GET /api/accounts/{id} returns account details",
              "PATCH /api/accounts/{id} updates display_name",
              "DELETE /api/accounts/{id} sets is_active=False"
            ],
            "edge_cases": [
              "POST with missing bank_name => 422",
              "POST duplicate account => returns existing (no duplicate created)",
              "DELETE already inactive account => 204 OK (idempotent)",
              "GET/PATCH/DELETE account of another user => 404"
            ],
            "security": [
              "All endpoints require JWT auth",
              "Ownership checks on GET/PATCH/DELETE by ID",
              "Cannot access accounts from other users"
            ]
          },
          "acceptance_criteria": [
            "All 5 endpoints implemented",
            "Schemas created in app/schemas/account.py",
            "POST implements get_or_create pattern (no duplicates)",
            "DELETE is soft delete (is_active flag)",
            "DELETE is idempotent",
            "Ownership checks implemented",
            "All edge cases tested in Swagger"
          ]
        },
        {
          "id": "milestone-1.3",
          "name": "PDF Cleanup + Logger",
          "status": "pending",
          "priority": "medium",
          "estimated_hours": 0.5,
          "complexity": "low",
          "description": "Implementar limpieza autom√°tica de PDFs con logging profesional",
          "files_to_modify": [
            {
              "path": "backend/app/services/statement_service.py",
              "changes": [
                "Import logging module",
                "Add logger = logging.getLogger(__name__)",
                "In process_statement(): Delete PDF after successful parsing",
                "Replace print() with logger.info()/logger.warning()"
              ]
            },
            {
              "path": "backend/app/main.py",
              "changes": [
                "Configure logging with basicConfig",
                "Set format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'",
                "Set level to INFO"
              ]
            }
          ],
          "implementation": {
            "location": "statement_service.py::process_statement()",
            "logic": [
              "After setting parsing_status = 'success'",
              "Check if PDF file exists at pdf_path",
              "Try to delete with os.remove()",
              "Log success with logger.info()",
              "Catch exceptions and log warning (do NOT fail the statement)",
              "DO NOT mark statement as failed if delete fails (only warning)"
            ],
            "code_pattern": "try: os.remove(pdf_path); logger.info(...) except: logger.warning(...)"
          },
          "business_rules": [
            "Only delete PDFs after parsing_status='success'",
            "If delete fails, log warning but don't fail the statement",
            "This prevents /tmp from filling up over time"
          ],
          "notes": [
            "V1: Delete after success (simple)",
            "V2: Consider moving to Supabase Storage for permanent storage",
            "V2: If you need re-processing, this breaks it (need to keep PDFs)"
          ],
          "testing_checklist": [
            "Upload and process a statement",
            "Verify PDF is deleted from /tmp/statements/{user_id}/",
            "Verify statement record still exists in DB",
            "Check logs show 'PDF deleted successfully' message",
            "Simulate delete failure (remove file manually) => should log warning, not crash"
          ],
          "acceptance_criteria": [
            "Logging configured in main.py",
            "All print() replaced with logger calls",
            "PDFs deleted after successful processing",
            "Delete failures are logged as warnings (not errors)",
            "Statement processing doesn't fail if delete fails"
          ]
        }
      ]
    },
    {
      "id": "phase-1.5",
      "name": "Quality & Developer Experience",
      "status": "pending",
      "priority": "high",
      "estimated_hours": 3,
      "description": "Mejorar calidad de c√≥digo y experiencia de desarrollo",
      "milestones": [
        {
          "id": "milestone-1.5a",
          "name": "Error Handling Estandarizado",
          "status": "pending",
          "priority": "medium",
          "estimated_hours": 1,
          "complexity": "low",
          "description": "Crear respuestas de error consistentes en toda la API",
          "files_to_create": [
            {
              "path": "backend/app/core/errors.py",
              "description": "Error response schemas and exception handlers",
              "schemas": [
                {
                  "name": "ErrorResponse",
                  "fields": {
                    "detail": "str (human-readable message)",
                    "code": "str (machine-readable code like INVALID_DATE_RANGE)",
                    "field": "Optional[str] (field that caused error)"
                  }
                }
              ],
              "error_codes": [
                "INVALID_DATE_RANGE",
                "LIMIT_EXCEEDED",
                "DUPLICATE_STATEMENT",
                "RESOURCE_NOT_FOUND",
                "UNAUTHORIZED_ACCESS"
              ]
            }
          ],
          "files_to_modify": [
            "All routers to use standardized HTTPException with ErrorResponse"
          ],
          "benefits": [
            "Better UX: Frontend can show user-friendly messages",
            "Easier debugging: Machine-readable error codes",
            "Consistency: All endpoints return same error format",
            "I18n ready: Error codes can be translated in frontend"
          ],
          "acceptance_criteria": [
            "ErrorResponse schema created",
            "Error codes documented",
            "All routers updated to use ErrorResponse format",
            "Tested in Swagger"
          ]
        },
        {
          "id": "milestone-1.5b",
          "name": "Seed Data Script",
          "status": "pending",
          "priority": "high",
          "estimated_hours": 2,
          "complexity": "medium",
          "description": "Script para generar datos de prueba realistas",
          "why_important": [
            "Acelera onboarding de nuevos developers (5 min setup vs 1 hora manual)",
            "Facilita demos y presentaciones",
            "Testing m√°s r√°pido (no need to manually create data)",
            "Permite reproducir bugs con datos consistentes"
          ],
          "files_to_create": [
            {
              "path": "backend/scripts/seed_demo_data.py",
              "description": "Generate realistic test data",
              "data_to_create": {
                "users": {
                  "count": 1,
                  "fields": {
                    "email": "demo@saldo.com",
                    "password": "Demo1234!",
                    "full_name": "Demo User"
                  }
                },
                "accounts": {
                  "count": 2,
                  "examples": [
                    {
                      "bank_name": "BBVA",
                      "account_type": "DEBIT",
                      "display_name": "BBVA Azul - Principal"
                    },
                    {
                      "bank_name": "Santander",
                      "account_type": "CREDIT",
                      "display_name": "Santander Free"
                    }
                  ]
                },
                "statements": {
                  "count": 1,
                  "fields": {
                    "bank": "BBVA",
                    "type": "DEBIT",
                    "month": "2025-01",
                    "parsing_status": "success"
                  }
                },
                "transactions": {
                  "count": 50,
                  "distribution": {
                    "CARGO": 20,
                    "ABONO": 25,
                    "UNKNOWN": 5
                  },
                  "categories": [
                    "Supermercado (OXXO, SORIANA)",
                    "Transporte (UBER, DIDI)",
                    "Restaurantes (STARBUCKS, MCDONALDS)",
                    "Servicios (CFE, TELMEX)",
                    "Transferencias"
                  ]
                }
              }
            }
          ],
          "dependencies": [
            "pip install Faker (for realistic fake data)"
          ],
          "usage": {
            "command": "python scripts/seed_demo_data.py",
            "output": [
              "‚úÖ User created: demo@saldo.com",
              "‚úÖ Accounts created: 2",
              "‚úÖ Statement created: 1",
              "‚úÖ Transactions created: 50",
              "üîë Login credentials:",
              "   Email: demo@saldo.com",
              "   Password: Demo1234!"
            ]
          },
          "acceptance_criteria": [
            "Script runs without errors",
            "Creates 1 user with known credentials",
            "Creates 2 accounts (different banks/types)",
            "Creates 50 realistic transactions with Faker",
            "Transactions distributed across CARGO/ABONO/UNKNOWN",
            "Script is idempotent (can run multiple times)",
            "Documented in README"
          ]
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Testing & Documentation",
      "status": "pending",
      "priority": "medium",
      "estimated_hours": 8,
      "description": "Tests automatizados y documentaci√≥n completa (opcional para MVP inicial)",
      "milestones": [
        {
          "id": "milestone-2.1",
          "name": "Automated Testing",
          "status": "pending",
          "priority": "medium",
          "estimated_hours": 6,
          "complexity": "medium",
          "description": "Tests automatizados con pytest",
          "target_coverage": {
            "auth": "80%+",
            "statements": "70%+",
            "transactions": "60%+",
            "accounts": "60%+"
          },
          "files_to_create": [
            "backend/tests/conftest.py (fixtures globales)",
            "backend/tests/test_auth.py",
            "backend/tests/test_statements.py",
            "backend/tests/test_transactions.py",
            "backend/tests/test_accounts.py"
          ],
          "dependencies": [
            "pytest",
            "pytest-asyncio",
            "httpx"
          ],
          "test_categories": [
            "Unit tests (services, utils)",
            "Integration tests (full API flow)",
            "Security tests (auth, ownership)",
            "Edge cases (validations, errors)"
          ]
        },
        {
          "id": "milestone-2.2",
          "name": "Documentation",
          "status": "pending",
          "priority": "low",
          "estimated_hours": 2,
          "complexity": "low",
          "description": "Documentaci√≥n completa para developers",
          "files_to_create": [
            "README.md (setup, quickstart, demo flow)",
            "CONTRIBUTING.md (git workflow, commit conventions)",
            "docs/API.md (endpoint documentation)",
            "docs/ARCHITECTURE.md (system design)",
            ".github/pull_request_template.md"
          ]
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Production Deployment",
      "status": "pending",
      "priority": "high",
      "estimated_hours": 8,
      "description": "Preparaci√≥n para producci√≥n y deployment",
      "milestones": [
        {
          "id": "milestone-3.1",
          "name": "Security Hardening",
          "status": "pending",
          "checklist": [
            "Rate limiting (slowapi or nginx)",
            "Input validation exhaustiva (Pydantic)",
            "SQL injection prevention (SQLAlchemy ‚úÖ)",
            "CORS configurado correctamente ‚úÖ",
            "Secrets en environment vars (no hardcoded) ‚úÖ",
            "HTTPS obligatorio",
            "Security headers (HSTS, CSP)"
          ]
        },
        {
          "id": "milestone-3.2",
          "name": "Deployment Setup",
          "status": "pending",
          "platform_options": [
            {
              "name": "Railway",
              "recommended": true,
              "pros": ["Auto-deploy from GitHub", "Postgres included", "$5/month"],
              "setup_required": ["Dockerfile", "railway.json"]
            },
            {
              "name": "Render",
              "pros": ["Free tier available", "Similar to Railway"],
              "setup_required": ["render.yaml"]
            },
            {
              "name": "Digital Ocean App Platform",
              "pros": ["More control", "$12/month"],
              "setup_required": ["app.yaml"]
            }
          ],
          "checklist": [
            "Create Dockerfile",
            "Setup platform config (railway.json/render.yaml)",
            "Configure environment variables",
            "Setup database migrations (Alembic)",
            "Create health check endpoint",
            "Configure monitoring/logging",
            "Test in staging environment",
            "Deploy to production"
          ]
        }
      ]
    }
  ],
  "testing_strategy": {
    "manual_testing": {
      "description": "Testing manual en Swagger antes de cada commit",
      "auth_tests": [
        {
          "endpoint": "POST /api/auth/register",
          "cases": [
            "‚úÖ Register with valid data => 201 Created",
            "‚ùå Register with existing email => 400 Bad Request",
            "‚ùå Register with weak password => 422 Validation Error"
          ]
        },
        {
          "endpoint": "POST /api/auth/login",
          "cases": [
            "‚úÖ Login with correct credentials => 200 + token",
            "‚ùå Login with wrong password => 401 Unauthorized",
            "‚ùå Login with non-existent email => 401 Unauthorized"
          ]
        },
        {
          "endpoint": "GET /api/auth/me",
          "cases": [
            "‚úÖ With valid token => 200 + user data",
            "‚ùå Without token => 401 Unauthorized",
            "‚ùå With expired token => 401 Unauthorized"
          ]
        }
      ],
      "statements_tests": [
        {
          "endpoint": "POST /api/statements/upload",
          "cases": [
            "‚úÖ Upload valid BBVA PDF => 201 Created",
            "‚ùå Upload same PDF twice => 400 Duplicate",
            "‚ùå Upload corrupted PDF => 400 Invalid PDF",
            "‚ùå Upload without auth => 401 Unauthorized"
          ]
        },
        {
          "endpoint": "POST /api/statements/{id}/process",
          "cases": [
            "‚úÖ Process valid statement => 200 + parsing_status=success",
            "‚ùå Process statement of another user => 404 Not Found",
            "‚ùå Process already processed statement => handle gracefully"
          ]
        }
      ],
      "transactions_tests": [
        {
          "endpoint": "GET /api/transactions/",
          "cases": [
            "‚úÖ No filters => all transactions ordered by date DESC",
            "‚úÖ With limit=10 => max 10 results",
            "‚úÖ With movement_type=CARGO => only CARGO transactions",
            "‚úÖ With account_id filter => only that account's transactions",
            "‚úÖ With date range => only transactions in range",
            "‚ùå With limit=5000 => capped to 200",
            "‚ùå With start_date > end_date => 422 Validation Error",
            "‚ùå With invalid movement_type => 422 Validation Error"
          ]
        },
        {
          "endpoint": "GET /api/transactions/stats",
          "cases": [
            "‚úÖ Returns correct count by type",
            "‚úÖ Sum of all counts = total transactions"
          ]
        },
        {
          "endpoint": "GET /api/transactions/{id}",
          "cases": [
            "‚úÖ Valid ID owned by user => 200 + transaction details",
            "‚ùå Valid ID owned by another user => 404 Not Found",
            "‚ùå Invalid UUID format => 422 Validation Error",
            "‚ùå Non-existent ID => 404 Not Found"
          ]
        },
        {
          "endpoint": "PATCH /api/transactions/{id}",
          "cases": [
            "‚úÖ Update movement_type to CARGO => needs_review auto-set to False",
            "‚úÖ Update movement_type to UNKNOWN => needs_review auto-set to True",
            "‚úÖ Update only display_name => other fields unchanged",
            "‚ùå Update with invalid movement_type => 422 Validation Error",
            "‚ùå Update transaction of another user => 404 Not Found"
          ]
        }
      ],
      "accounts_tests": [
        {
          "endpoint": "POST /api/accounts/",
          "cases": [
            "‚úÖ Create new account => 201 Created",
            "‚úÖ Create duplicate (same bank+type) => returns existing account",
            "‚ùå Create without required fields => 422 Validation Error"
          ]
        },
        {
          "endpoint": "GET /api/accounts/",
          "cases": [
            "‚úÖ No filters => all user's accounts",
            "‚úÖ Filter by is_active=true => only active accounts",
            "‚úÖ Filter by bank_name => only that bank's accounts"
          ]
        },
        {
          "endpoint": "PATCH /api/accounts/{id}",
          "cases": [
            "‚úÖ Update display_name => name changed",
            "‚úÖ Update is_active to False => account deactivated",
            "‚ùå Update account of another user => 404 Not Found"
          ]
        },
        {
          "endpoint": "DELETE /api/accounts/{id}",
          "cases": [
            "‚úÖ Delete active account => 204 + is_active=False",
            "‚úÖ Delete already inactive account => 204 (idempotent)",
            "‚úÖ Transactions remain visible after delete",
            "‚ùå Delete account of another user => 404 Not Found"
          ]
        }
      ]
    },
    "automated_testing": {
      "description": "Tests automatizados con pytest (Phase 2)",
      "coverage_target": "60%+ overall",
      "priority_areas": [
        "Auth (critical for security)",
        "Statement processing (complex logic)",
        "Transaction deduplication",
        "Ownership checks (security)"
      ]
    }
  },
  "git_workflow": {
    "current_branch": "feature/transactions-account-endpoints",
    "main_branch": "main",
    "commit_strategy": [
      {
        "milestone": "1.1 - Transactions Router",
        "commits": [
          "feat: add transactions endpoints (GET list, GET stats, GET by id, PATCH)",
          "feat: add strict validations for transactions filters",
          "feat: implement auto needs_review business rules"
        ]
      },
      {
        "milestone": "1.2 - Accounts Router",
        "commits": [
          "feat: add account schemas (AccountResponse, AccountCreate, AccountUpdate)",
          "feat: add accounts CRUD endpoints",
          "feat: implement soft delete for accounts"
        ]
      },
      {
        "milestone": "1.3 - PDF Cleanup",
        "commits": [
          "feat: configure logging in application",
          "feat: auto-delete PDFs after successful processing"
        ]
      },
      {
        "milestone": "1.5 - Quality",
        "commits": [
          "feat: add standardized error responses",
          "feat: add seed demo data script"
        ]
      }
    ],
    "pr_strategy": {
      "title": "feat: Add Transactions & Accounts CRUD endpoints (Phase 1 + 1.5)",
      "description_template": "## Summary\n- ‚úÖ Transactions Router (4 endpoints)\n- ‚úÖ Accounts Router (5 endpoints)\n- ‚úÖ PDF cleanup with logging\n- ‚úÖ Strict validations & business rules\n- ‚úÖ Seed data script\n\n## Testing\n- Manual testing completed in Swagger\n- All edge cases verified\n- Security (ownership checks) validated\n\n## Next Steps\n- Merge to main\n- Deploy to staging\n- Begin Phase 2 (automated tests)"
    }
  },
  "definition_of_done": {
    "phase_1": {
      "transactions_router": [
        "‚úÖ All 4 endpoints implemented",
        "‚úÖ Validations: limit (max 200), offset >= 0, start_date <= end_date",
        "‚úÖ ORDER BY transaction_date DESC explicit",
        "‚úÖ Business rules: movement_type affects needs_review automatically",
        "‚úÖ Ownership checks on GET/PATCH by ID",
        "‚úÖ Error responses: 404 (not 403) for unauthorized access",
        "‚úÖ Partial update (only update sent fields)",
        "‚úÖ All edge cases tested in Swagger",
        "‚úÖ Registered in main.py"
      ],
      "accounts_router": [
        "‚úÖ All 5 endpoints implemented",
        "‚úÖ Schemas created (AccountResponse, AccountCreate, AccountUpdate)",
        "‚úÖ Uniqueness: (user_id, bank_name, account_type)",
        "‚úÖ Normalization: bank_name uppercase",
        "‚úÖ POST uses get_or_create pattern (no duplicates)",
        "‚úÖ DELETE is soft delete (is_active flag)",
        "‚úÖ DELETE is idempotent",
        "‚úÖ Ownership checks implemented",
        "‚úÖ All edge cases tested",
        "‚úÖ Registered in main.py"
      ],
      "pdf_cleanup": [
        "‚úÖ Logging configured in main.py",
        "‚úÖ All print() replaced with logger",
        "‚úÖ PDFs deleted after parsing_status=success",
        "‚úÖ Delete failures logged as warnings (not errors)",
        "‚úÖ Statement processing doesn't fail if delete fails"
      ]
    },
    "phase_1_5": {
      "error_handling": [
        "‚úÖ ErrorResponse schema created",
        "‚úÖ Error codes defined and documented",
        "‚úÖ All routers use standardized error format",
        "‚úÖ Tested in Swagger"
      ],
      "seed_script": [
        "‚úÖ Script runs without errors",
        "‚úÖ Creates demo user (demo@saldo.com)",
        "‚úÖ Creates 2 accounts (BBVA, Santander)",
        "‚úÖ Creates 50 realistic transactions",
        "‚úÖ Script is idempotent",
        "‚úÖ Documented in README"
      ]
    },
    "mvp_ready": [
      "‚úÖ User can register and authenticate",
      "‚úÖ User can upload and process BBVA debit statements",
      "‚úÖ User can view/filter/edit transactions via API",
      "‚úÖ User can manage bank accounts (CRUD)",
      "‚úÖ All manual tests passing",
      "‚úÖ Seed script available for demos",
      "‚úÖ API deployed and publicly accessible"
    ]
  },
  "time_estimates": {
    "phase_1": {
      "total_hours": 14,
      "breakdown": {
        "milestone_1_1": 4,
        "milestone_1_2": 4,
        "milestone_1_3": 0.5,
        "buffer": 1.5
      },
      "calendar_time": {
        "full_time": "2 days",
        "part_time": "1 week"
      }
    },
    "phase_1_5": {
      "total_hours": 3,
      "breakdown": {
        "error_handling": 1,
        "seed_script": 2
      }
    },
    "total_mvp": {
      "hours": 17,
      "calendar_time": {
        "full_time": "2-3 days",
        "part_time": "1.5 weeks"
      }
    }
  },
  "success_metrics": {
    "technical": [
      "All endpoints respond < 500ms",
      "Zero 500 errors in manual testing",
      "JWT auth working on all protected endpoints",
      "Ownership checks prevent cross-user access",
      "Validations catch all edge cases"
    ],
    "business": [
      "User can complete full flow: register ‚Üí upload ‚Üí process ‚Üí view transactions",
      "Demo-ready with seed data",
      "Swagger docs are complete and accurate",
      "API is deployed and accessible",
      "Ready to connect with frontend"
    ]
  },
  "risks_and_mitigations": {
    "risks": [
      {
        "risk": "PDF parser only supports BBVA debit",
        "impact": "Medium",
        "mitigation": "Document limitation, add support for other banks in V1.1",
        "status": "Accepted for MVP"
      },
      {
        "risk": "No automated tests for MVP",
        "impact": "Medium",
        "mitigation": "Comprehensive manual testing checklist, add automated tests in Phase 2",
        "status": "Mitigated"
      },
      {
        "risk": "PDFs deleted after processing prevents re-processing",
        "impact": "Low",
        "mitigation": "Document behavior, plan migration to Supabase Storage for V2",
        "status": "Accepted for MVP"
      },
      {
        "risk": "No rate limiting on MVP",
        "impact": "Low",
        "mitigation": "Add in Phase 3 before public launch",
        "status": "Scheduled"
      }
    ]
  },
  "next_actions": [
    {
      "priority": 1,
      "action": "Start Milestone 1.1: Create transactions router",
      "estimated_time": "4 hours",
      "blocking": true
    },
    {
      "priority": 2,
      "action": "Start Milestone 1.2: Create accounts router",
      "estimated_time": "4 hours",
      "blocking": true
    },
    {
      "priority": 3,
      "action": "Start Milestone 1.3: Add PDF cleanup",
      "estimated_time": "30 minutes",
      "blocking": true
    },
    {
      "priority": 4,
      "action": "Start Milestone 1.5b: Create seed script",
      "estimated_time": "2 hours",
      "blocking": false
    },
    {
      "priority": 5,
      "action": "Manual testing all endpoints",
      "estimated_time": "2 hours",
      "blocking": true
    },
    {
      "priority": 6,
      "action": "Create PR and merge to main",
      "estimated_time": "30 minutes",
      "blocking": true
    }
  ],
  "import_instructions": {
    "notion": {
      "method_1_web_ui": [
        "1. Open Notion workspace",
        "2. Create new page titled 'Saldo Backend Roadmap'",
        "3. Click '...' menu ‚Üí Import",
        "4. Select 'JSON - Markdown' format",
        "5. Upload this roadmap.json file",
        "6. Notion will parse and create database/pages automatically"
      ],
      "method_2_api": {
        "description": "Use Notion API to programmatically import",
        "tools": ["notion-py", "Official Notion SDK"],
        "steps": [
          "Install: pip install notion-client",
          "Get API key from https://www.notion.so/my-integrations",
          "Parse roadmap.json and create pages via API",
          "See: https://developers.notion.com/docs/create-a-page"
        ]
      },
      "method_3_copy_paste": [
        "1. Install: npm install -g notion-md-gen (if you want markdown)",
        "2. Or just copy sections manually from JSON to Notion",
        "3. Create database for milestones with columns: id, name, status, priority, hours",
        "4. Create pages for each phase",
        "5. Link milestones to phases"
      ]
    },
    "other_tools": {
      "github_projects": "Use gh CLI to create issues from milestones",
      "trello": "Import as board with lists for each phase",
      "linear": "API import for issues",
      "google_sheets": "Flatten to CSV for project tracking"
    }
  }
}
